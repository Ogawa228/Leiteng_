import requests
from bs4 import BeautifulSoup
import tkinter as tk
from tkinter import simpledialog, filedialog

# 初始化TKinter
root = tk.Tk()
root.withdraw()  # 隐藏主窗口

# 使用对话框请求用户输入URL
url = simpledialog.askstring("输入URL", "请输入要提取Markdown链接的网页的URL:")

# 确保用户输入了URL
if not url:
    print("未输入URL。程序已退出。")
    exit()

# 使用对话框请求用户选择保存文件的目录
output_directory = filedialog.askdirectory(title="选择保存文件的目录")

# 确保用户选择了目录
if not output_directory:
    print("未选择保存目录。程序已退出。")
    exit()

output_filename = f"{output_directory}/markdown_links.txt"  # 输出文件的完整路径

# 获取网页内容
response = requests.get(url)
html = response.text

# 解析网页内容
soup = BeautifulSoup(html, 'html.parser')

# 准备写入文件
with open(output_filename, 'w', encoding='utf-8') as file:
    # 查找所有的<a>标签
    links = soup.find_all('a')

    # 转换为Markdown格式并写入文件
    for link in links:
        if 'href' in link.attrs:
            markdown_link = f"[{link.get_text().strip()}]({link['href']})"
            file.write(markdown_link + '\n')  # 写入到文件

print(f"所有的Markdown链接已经被写入到文件 {output_filename}。")
